---
interface Props {
  title?: string;
  description?: string;
}

const { 
  title = "Portfolio | Gerardo Romani",
  description = "Portfolio creativo di Gerardo Romani"
} = Astro.props;
---

<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <meta name="description" content={description}>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Archivo+Black&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Animated Background Grid -->
  <div class="grid-background"></div>

  <slot />

  <script>
    // ============================================
    // PHOTOS - Scroll automatico + manuale (drag orizzontale)
    // ============================================
    const photosContainer = document.querySelector('.photos-scroll-container') as HTMLElement;
    
    if (photosContainer) {
      let isPhotosDragging = false;
      let photosStartX = 0;
      let photosScrollLeft = 0;
      let photosAutoScrollInterval: number | null = null;
      let photosScrollDirection = 1; // 1 = destra, -1 = sinistra
      const photosAutoScrollSpeed = 1; // pixel per frame (velocità moderata)

      // Funzione per avviare lo scroll automatico
      const startPhotosAutoScroll = () => {
        if (photosAutoScrollInterval) return;
        
        photosAutoScrollInterval = window.setInterval(() => {
          if (!isPhotosDragging && photosContainer) {
            const maxScroll = photosContainer.scrollWidth - photosContainer.clientWidth;
            
            // Cambia direzione quando raggiunge i bordi
            if (photosContainer.scrollLeft >= maxScroll) {
              photosScrollDirection = -1;
            } else if (photosContainer.scrollLeft <= 0) {
              photosScrollDirection = 1;
            }
            
            photosContainer.scrollLeft += photosAutoScrollSpeed * photosScrollDirection;
          }
        }, 16); // ~60 FPS
      };

      // Funzione per fermare lo scroll automatico
      const stopPhotosAutoScroll = () => {
        if (photosAutoScrollInterval) {
          clearInterval(photosAutoScrollInterval);
          photosAutoScrollInterval = null;
        }
      };

      // Avvia lo scroll automatico all'inizio
      startPhotosAutoScroll();

      // Mouse drag
      photosContainer.addEventListener('mousedown', (e: MouseEvent) => {
        isPhotosDragging = true;
        photosStartX = e.pageX - photosContainer.offsetLeft;
        photosScrollLeft = photosContainer.scrollLeft;
        stopPhotosAutoScroll();
      });

      photosContainer.addEventListener('mouseleave', () => {
        if (isPhotosDragging) {
          isPhotosDragging = false;
          // Riprendi auto-scroll dopo 1 secondo
          setTimeout(() => startPhotosAutoScroll(), 1000);
        }
      });

      photosContainer.addEventListener('mouseup', () => {
        if (isPhotosDragging) {
          isPhotosDragging = false;
          // Riprendi auto-scroll dopo 1 secondo
          setTimeout(() => startPhotosAutoScroll(), 1000);
        }
      });

      photosContainer.addEventListener('mousemove', (e: MouseEvent) => {
        if (!isPhotosDragging) return;
        e.preventDefault();
        const x = e.pageX - photosContainer.offsetLeft;
        const walk = (x - photosStartX) * 1.5;
        photosContainer.scrollLeft = photosScrollLeft - walk;
      });

      // Touch drag per mobile
      let photosTouchStartX = 0;
      let photosTouchScrollLeft = 0;

      photosContainer.addEventListener('touchstart', (e: TouchEvent) => {
        photosTouchStartX = e.touches[0].pageX;
        photosTouchScrollLeft = photosContainer.scrollLeft;
        stopPhotosAutoScroll();
      }, { passive: true });

      photosContainer.addEventListener('touchmove', (e: TouchEvent) => {
        const x = e.touches[0].pageX;
        const walk = (photosTouchStartX - x) * 1.5;
        photosContainer.scrollLeft = photosTouchScrollLeft + walk;
      }, { passive: true });

      photosContainer.addEventListener('touchend', () => {
        // Riprendi auto-scroll dopo 1 secondo
        setTimeout(() => startPhotosAutoScroll(), 1000);
      }, { passive: true });
    }

    // ============================================
    // VIDEOS - Scroll automatico + manuale (drag verticale)
    // ============================================
    const videosContainer = document.querySelector('.videos-scroll-container') as HTMLElement;
    
    if (videosContainer) {
      let isVideosDragging = false;
      let videosStartY = 0;
      let videosScrollTop = 0;
      let videosAutoScrollInterval: number | null = null;
      let videosScrollDirection = 1; // 1 = giù, -1 = su
      const videosAutoScrollSpeed = 0.8; // pixel per frame (velocità moderata)

      // Funzione per avviare lo scroll automatico
      const startVideosAutoScroll = () => {
        if (videosAutoScrollInterval) return;
        
        videosAutoScrollInterval = window.setInterval(() => {
          if (!isVideosDragging && videosContainer) {
            const maxScroll = videosContainer.scrollHeight - videosContainer.clientHeight;
            
            // Cambia direzione quando raggiunge i bordi
            if (videosContainer.scrollTop >= maxScroll) {
              videosScrollDirection = -1;
            } else if (videosContainer.scrollTop <= 0) {
              videosScrollDirection = 1;
            }
            
            videosContainer.scrollTop += videosAutoScrollSpeed * videosScrollDirection;
          }
        }, 16); // ~60 FPS
      };

      // Funzione per fermare lo scroll automatico
      const stopVideosAutoScroll = () => {
        if (videosAutoScrollInterval) {
          clearInterval(videosAutoScrollInterval);
          videosAutoScrollInterval = null;
        }
      };

      // Avvia lo scroll automatico all'inizio
      startVideosAutoScroll();

      // Mouse drag
      videosContainer.addEventListener('mousedown', (e: MouseEvent) => {
        isVideosDragging = true;
        videosStartY = e.pageY - videosContainer.offsetTop;
        videosScrollTop = videosContainer.scrollTop;
        stopVideosAutoScroll();
      });

      videosContainer.addEventListener('mouseleave', () => {
        if (isVideosDragging) {
          isVideosDragging = false;
          // Riprendi auto-scroll dopo 1 secondo
          setTimeout(() => startVideosAutoScroll(), 1000);
        }
      });

      videosContainer.addEventListener('mouseup', () => {
        if (isVideosDragging) {
          isVideosDragging = false;
          // Riprendi auto-scroll dopo 1 secondo
          setTimeout(() => startVideosAutoScroll(), 1000);
        }
      });

      videosContainer.addEventListener('mousemove', (e: MouseEvent) => {
        if (!isVideosDragging) return;
        e.preventDefault();
        const y = e.pageY - videosContainer.offsetTop;
        const walk = (y - videosStartY) * 1.5;
        videosContainer.scrollTop = videosScrollTop - walk;
      });

      // Touch drag per mobile
      let videosTouchStartY = 0;
      let videosTouchScrollTop = 0;

      videosContainer.addEventListener('touchstart', (e: TouchEvent) => {
        videosTouchStartY = e.touches[0].pageY;
        videosTouchScrollTop = videosContainer.scrollTop;
        stopVideosAutoScroll();
      }, { passive: true });

      videosContainer.addEventListener('touchmove', (e: TouchEvent) => {
        const y = e.touches[0].pageY;
        const walk = (videosTouchStartY - y) * 1.5;
        videosContainer.scrollTop = videosTouchScrollTop + walk;
      }, { passive: true });

      videosContainer.addEventListener('touchend', () => {
        // Riprendi auto-scroll dopo 1 secondo
        setTimeout(() => startVideosAutoScroll(), 1000);
      }, { passive: true });
    }

    // ============================================
    // LIGHTBOX for Photos - Click to enlarge
    // ============================================
    const lightbox = document.getElementById('photoLightbox');
    const lightboxImage = document.getElementById('lightboxImage') as HTMLImageElement;
    const lightboxClose = document.querySelector('.lightbox-close');

    document.addEventListener('click', (e: MouseEvent) => {
      const target = e.target as HTMLElement;
      const photoItem = target.closest('.photo-item');
      if (photoItem && !target.closest('.lightbox')) {
        const img = photoItem.querySelector('img');
        if (img && lightboxImage && lightbox) {
          lightboxImage.src = img.src;
          lightbox.classList.add('active');
        }
      }
    });

    if (lightboxClose && lightbox) {
      lightboxClose.addEventListener('click', () => {
        lightbox.classList.remove('active');
      });
    }

    if (lightbox && lightboxImage) {
      lightbox.addEventListener('click', (e: MouseEvent) => {
        if (e.target === lightbox || e.target === lightboxImage) {
          lightbox.classList.remove('active');
        }
      });
    }

    document.addEventListener('keydown', (e: KeyboardEvent) => {
      if (e.key === 'Escape' && lightbox && lightbox.classList.contains('active')) {
        lightbox.classList.remove('active');
      }
    });

    // ============================================
    // Mobile Navigation Toggle
    // ============================================
    const navToggle = document.getElementById('navToggle');
    const navLinks = document.querySelector('.nav-links');

    if (navToggle && navLinks) {
      navToggle.addEventListener('click', () => {
        navToggle.classList.toggle('active');
        navLinks.classList.toggle('active');
      });

      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
          navToggle.classList.remove('active');
          navLinks.classList.remove('active');
        });
      });

      document.addEventListener('click', (e: MouseEvent) => {
        const target = e.target as HTMLElement;
        if (!navToggle.contains(target) && !navLinks.contains(target)) {
          navToggle.classList.remove('active');
          navLinks.classList.remove('active');
        }
      });
    }

    // ============================================
    // Contact Form Handler
    // ============================================
    const contactForm = document.getElementById('contactForm') as HTMLFormElement;
    const formMessage = document.getElementById('formMessage');

    if (contactForm && formMessage) {
      contactForm.addEventListener('submit', async (e: Event) => {
        e.preventDefault();

        const nameInput = document.getElementById('name') as HTMLInputElement;
        const emailInput = document.getElementById('email') as HTMLInputElement;
        const subjectInput = document.getElementById('subject') as HTMLInputElement;
        const messageInput = document.getElementById('message') as HTMLTextAreaElement;

        try {
          await new Promise(resolve => setTimeout(resolve, 1000));

          formMessage.textContent = 'Messaggio inviato con successo! Ti risponderò presto.';
          formMessage.className = 'form-message success';
          formMessage.style.display = 'block';
          
          contactForm.reset();

          setTimeout(() => {
            formMessage.style.display = 'none';
          }, 5000);

        } catch (error) {
          formMessage.textContent = 'Errore nell\'invio del messaggio. Riprova più tardi.';
          formMessage.className = 'form-message error';
          formMessage.style.display = 'block';
        }
      });
    }

    // ============================================
    // Smooth scroll enhancement
    // ============================================
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e: Event) {
        e.preventDefault();
        const href = (this as HTMLAnchorElement).getAttribute('href');
        if (href) {
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        }
      });
    });

    // ============================================
    // Intersection Observer for animations
    // ============================================
    const observerOptions: IntersectionObserverInit = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, observerOptions);

    document.querySelectorAll('section').forEach(section => {
      observer.observe(section);
    });
  </script>
</body>
</html>

<style is:global>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :root {
    /* Beige-Terracotta Palette */
    --primary-white: #F5F1E8;
    --light-gray: #E8DFD0;
    --medium-gray: #D4C4B0;
    --primary-blue: #C75B39;
    --secondary-blue: #E8997A;
    --light-blue: #F4C3A8;
    --accent-blue: #A94527;
    --dark-blue: #8B4513;
    --dark-bg: #2C1810;
    --darker-bg: #1A0F08;
    --text-white: #F5F1E8;
    --text-gray: #C9B8A3;
    --text-dark: #3D2817;
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--darker-bg);
    color: var(--text-white);
    overflow-x: hidden;
    position: relative;
  }

  .grid-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
      linear-gradient(rgba(0, 78, 137, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(26, 101, 158, 0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    z-index: 0;
    animation: gridMove 20s linear infinite;
  }

  @keyframes gridMove {
    0% { background-position: 0 0; }
    100% { background-position: 50px 50px; }
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    position: relative;
    z-index: 1;
  }

  section {
    padding: 8rem 0;
    position: relative;
    z-index: 1;
    opacity: 0;
    transform: translateY(50px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  section.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .section-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  .section-title {
    font-family: 'Archivo Black', sans-serif;
    font-size: clamp(2.5rem, 5vw, 4rem);
    background: linear-gradient(135deg, var(--light-blue), var(--primary-blue));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
    letter-spacing: 3px;
  }
</style>
