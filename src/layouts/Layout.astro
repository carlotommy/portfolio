---
interface Props {
  title?: string;
  description?: string;
}

const { 
  title = "Portfolio | Gerardo Romani",
  description = "Portfolio creativo di Gerardo Romani"
} = Astro.props;
---

<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <meta name="description" content={description}>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Archivo+Black&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/src/styles/global.css">
</head>
<body>
  <!-- Animated Background Grid -->
  <div class="grid-background"></div>

  <slot />

  <script>
    // Auto-scrolling Photos Carousel with BIDIRECTIONAL INFINITE LOOP
    const photosScrollTrack = document.getElementById('photosScrollTrack');
    const photoItems = document.querySelectorAll('.photo-item');
    
    // Clone items multiple times for seamless bidirectional infinite loop
    if (photosScrollTrack && photoItems.length > 0) {
      // Clone three times for smooth loop
      photoItems.forEach(item => {
        const clone = item.cloneNode(true);
        photosScrollTrack.appendChild(clone);
      });
      photoItems.forEach(item => {
        const clone = item.cloneNode(true);
        photosScrollTrack.appendChild(clone);
      });
      photoItems.forEach(item => {
        const clone = item.cloneNode(true);
        photosScrollTrack.appendChild(clone);
      });
    }

    // Enable manual scroll interaction for photos
    const photosContainer = document.querySelector('.photos-scroll-container');
    let isPhotosScrolling = false;
    let photosStartX;
    let photosScrollLeft;

    if (photosContainer) {
      photosContainer.addEventListener('mousedown', (e) => {
        isPhotosScrolling = true;
        photosStartX = e.pageX - photosContainer.offsetLeft;
        photosScrollLeft = photosContainer.scrollLeft;
        photosScrollTrack.style.animationPlayState = 'paused';
      });

      photosContainer.addEventListener('mouseleave', () => {
        isPhotosScrolling = false;
        photosScrollTrack.style.animationPlayState = 'running';
      });

      photosContainer.addEventListener('mouseup', () => {
        isPhotosScrolling = false;
        photosScrollTrack.style.animationPlayState = 'running';
      });

      photosContainer.addEventListener('mousemove', (e) => {
        if (!isPhotosScrolling) return;
        e.preventDefault();
        const x = e.pageX - photosContainer.offsetLeft;
        const walk = (x - photosStartX) * 2;
        photosContainer.scrollLeft = photosScrollLeft - walk;
      });

      // Touch support for mobile
      photosContainer.addEventListener('touchstart', () => {
        photosScrollTrack.style.animationPlayState = 'paused';
      });

      photosContainer.addEventListener('touchend', () => {
        photosScrollTrack.style.animationPlayState = 'running';
      });
    }

    // LIGHTBOX for Photos - Click to enlarge
    const lightbox = document.getElementById('photoLightbox');
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxClose = document.querySelector('.lightbox-close');

    // Add click listener to all photos (originals and clones)
    document.addEventListener('click', (e) => {
      const photoItem = e.target.closest('.photo-item');
      if (photoItem && !e.target.closest('.lightbox')) {
        const img = photoItem.querySelector('img');
        if (img) {
          lightboxImage.src = img.src;
          lightbox.classList.add('active');
        }
      }
    });

    // Close lightbox with button
    if (lightboxClose) {
      lightboxClose.addEventListener('click', () => {
        lightbox.classList.remove('active');
      });
    }

    // Close lightbox by clicking on image or background
    if (lightbox) {
      lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox || e.target === lightboxImage) {
          lightbox.classList.remove('active');
        }
      });
    }

    // Close with ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && lightbox.classList.contains('active')) {
        lightbox.classList.remove('active');
      }
    });

    // Auto-scrolling Videos with TRUE INFINITE CIRCULAR LOOP
    const videosGrid = document.querySelector('.videos-grid');
    const videoCards = document.querySelectorAll('.video-card');
    
    // Clone video items TWICE for seamless infinite loop
    if (videosGrid && videoCards.length > 0) {
      // First clone
      videoCards.forEach(card => {
        const clone = card.cloneNode(true);
        videosGrid.appendChild(clone);
      });
      // Second clone for extra smooth loop
      videoCards.forEach(card => {
        const clone = card.cloneNode(true);
        videosGrid.appendChild(clone);
      });
    }

    // Enable manual scroll interaction for videos
    const videosContainer = document.querySelector('.videos-scroll-container');

    if (videosContainer) {
      videosContainer.addEventListener('wheel', () => {
        videosGrid.style.animationPlayState = 'paused';
        clearTimeout(videosContainer.scrollTimeout);
        videosContainer.scrollTimeout = setTimeout(() => {
          videosGrid.style.animationPlayState = 'running';
        }, 1000);
      });

      videosContainer.addEventListener('touchstart', () => {
        videosGrid.style.animationPlayState = 'paused';
      });

      videosContainer.addEventListener('touchend', () => {
        setTimeout(() => {
          videosGrid.style.animationPlayState = 'running';
        }, 1000);
      });

      videosContainer.addEventListener('mouseenter', () => {
        videosGrid.style.animationPlayState = 'paused';
      });

      videosContainer.addEventListener('mouseleave', () => {
        videosGrid.style.animationPlayState = 'running';
      });
    }

    // Mobile Navigation Toggle
    const navToggle = document.getElementById('navToggle');
    const navLinks = document.querySelector('.nav-links');

    if (navToggle && navLinks) {
      navToggle.addEventListener('click', () => {
        navToggle.classList.toggle('active');
        navLinks.classList.toggle('active');
      });

      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
          navToggle.classList.remove('active');
          navLinks.classList.remove('active');
        });
      });

      document.addEventListener('click', (e) => {
        if (!navToggle.contains(e.target) && !navLinks.contains(e.target)) {
          navToggle.classList.remove('active');
          navLinks.classList.remove('active');
        }
      });
    }

    // Contact Form Handler
    const contactForm = document.getElementById('contactForm');
    const formMessage = document.getElementById('formMessage');

    if (contactForm) {
      contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = {
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          subject: document.getElementById('subject').value,
          message: document.getElementById('message').value
        };

        try {
          await new Promise(resolve => setTimeout(resolve, 1000));

          formMessage.textContent = 'Messaggio inviato con successo! Ti risponderò presto.';
          formMessage.className = 'form-message success';
          contactForm.reset();

          setTimeout(() => {
            formMessage.style.display = 'none';
          }, 5000);

        } catch (error) {
          formMessage.textContent = 'Errore nell\'invio del messaggio. Riprova più tardi.';
          formMessage.className = 'form-message error';
        }
      });
    }

    // Smooth scroll enhancement
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Intersection Observer for animations
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, observerOptions);

    document.querySelectorAll('section').forEach(section => {
      observer.observe(section);
    });
  </script>
</body>
</html>
